import{_ as e}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as t,a as s,b as l,e as n,f as a,o as h}from"./app-Cfgedju3.js";const r="/assets/meme-01-BWXxH-Jc.jpg",d={};function k(p,i){return h(),t("div",null,[i[0]||(i[0]=s("h1",{id:"git-filter-branch-清理指南",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#git-filter-branch-清理指南"},[s("span",null,"Git Filter-Branch 清理指南")])],-1)),i[1]||(i[1]=s("h2",{id:"前言",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#前言"},[s("span",null,"前言")])],-1)),i[2]||(i[2]=s("p",null,"在開發過程中難免會犯錯，像是不小心推送了機密檔案、大型檔案，或是一些不該存在於版本控制中的檔案。",-1)),i[3]||(i[3]=s("p",null,"如果專案還很新，可以砍掉 .git 目錄，但過去的提交紀錄也都會不見。",-1)),i[4]||(i[4]=s("p",null,[a("這時候就需要用到 "),s("code",null,"git filter-branch"),a(" 來重寫 Git 歷史記錄。")],-1)),l(" more "),i[5]||(i[5]=n('<p>不論是故意還是不小心幹了壞事，</p><p>完美湮滅犯案過程才是專業！！</p><figure><img src="'+r+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>不過使用前請三思，因為這會改變歷史記錄，如果其他人已經基於該分支工作，會需要額外的協調處理。</p><h2 id="為什麼不能直接刪除檔案" tabindex="-1"><a class="header-anchor" href="#為什麼不能直接刪除檔案"><span>為什麼不能直接刪除檔案？</span></a></h2><p>許多人可能會問：「為什麼不直接刪除檔案就好？」</p><p><strong>直接刪除 vs git filter-branch 的差別</strong>：</p><table><thead><tr><th>操作方式</th><th>檔案狀態</th><th>Git 歷史</th><th>倉庫大小</th><th>安全性</th></tr></thead><tbody><tr><td>直接刪除</td><td>目前版本消失</td><td><strong>歷史仍保留</strong></td><td><strong>不變</strong></td><td>❌ 敏感資料仍可存取</td></tr><tr><td>filter-branch</td><td>完全消失</td><td><strong>歷史重寫</strong></td><td><strong>減少</strong></td><td>✅ 完全移除</td></tr></tbody></table><p><strong>具體差異</strong>：</p><ol><li><strong>倉庫大小</strong>：直接刪除大檔案後，Git 歷史中仍保留所有版本，<code>.git</code> 資料夾大小不會減少</li><li><strong>安全考量</strong>：即使刪除了包含密碼或 API 金鑰的檔案，任何人都可以透過 <code>git log</code> 和 <code>git checkout</code> 存取舊版本</li><li><strong>合規需求</strong>：某些資料保護法規要求完全移除特定資料，單純刪除無法滿足要求</li><li><strong>專業形象</strong>：Git 歷史是專案的永久記錄，保持乾淨的歷史有助於維護專業形象</li></ol><p><strong>範例說明</strong>：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 假設你不小心推送了 secret.txt</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;password=123456&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">secret.txt</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> add</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> secret.txt</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> commit</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -m</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;Add config&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> push</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 方案 1: 直接刪除（問題方案）</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rm</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> secret.txt</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> commit</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -m</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;Remove secret file&quot;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 結果：檔案消失了，但任何人都可以用以下指令看到密碼</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> show</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> HEAD~1:secret.txt</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 仍然會顯示 &quot;password=123456&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 方案 2: 使用 filter-branch（正確方案）</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> filter-branch</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --force</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --index-filter</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;git rm --cached --ignore-unmatch secret.txt&#39;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> HEAD</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 結果：檔案從歷史中完全消失，無法存取</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="概述" tabindex="-1"><a class="header-anchor" href="#概述"><span>概述</span></a></h2><p><code>git filter-branch</code> 是一個強大的工具，用於重寫 Git 歷史記錄。<br> 當推送了不該存在的檔案時，可以使用此工具來清理特定分支的歷史。</p><h2 id="基本語法" tabindex="-1"><a class="header-anchor" href="#基本語法"><span>基本語法</span></a></h2><ul><li>指定分支進行清理</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> filter-branch</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --force</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --index-filter</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;git rm --cached --ignore-unmatch 檔案路徑&#39;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 分支名稱</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>清理單一檔案</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> filter-branch</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --force</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --index-filter</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;git rm --cached --ignore-unmatch secret.txt&#39;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> feature/my-branch</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>清理整個資料夾</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> filter-branch</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --force</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --index-filter</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;git rm -rf --cached --ignore-unmatch folder/&#39;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> feature/my-branch</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>清理多個檔案類型</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> filter-branch</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --force</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --index-filter</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;git rm --cached --ignore-unmatch *.log *.tmp&#39;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> feature/my-branch</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="參數說明" tabindex="-1"><a class="header-anchor" href="#參數說明"><span>參數說明</span></a></h2><ul><li><code>--force</code>: 強制執行，覆蓋之前的備份</li><li><code>--index-filter</code>: 在每個 commit 的索引上執行命令</li><li><code>--cached</code>: 只從索引中移除，不影響工作目錄</li><li><code>--ignore-unmatch</code>: 忽略檔案不存在的錯誤</li></ul><h2 id="完成後的操作" tabindex="-1"><a class="header-anchor" href="#完成後的操作"><span>完成後的操作</span></a></h2><ol><li>強制推送到遠端</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> push</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> origin</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 分支名稱</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --force</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="2"><li>清理本地備份</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> for-each-ref</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --format=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;%(refname)&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> refs/original/</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">xargs</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> update-ref</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -d</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="3"><li>執行垃圾回收</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> gc</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --prune=now</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="4"><li>處理空 Commit 問題</li></ol><p>使用 <code>filter-branch</code> 清理檔案後，某些 commit 可能變成空的（沒有實際變更）。</p><h2 id="常見問題" tabindex="-1"><a class="header-anchor" href="#常見問題"><span>常見問題</span></a></h2><p>Commit 有 message 但沒有檔案變更</p><ul><li><code>git show --stat</code> 顯示無變更統計</li></ul><h2 id="解決方法" tabindex="-1"><a class="header-anchor" href="#解決方法"><span>解決方法</span></a></h2><ul><li>方法 1: 使用 Interactive Rebase</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rebase</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> HEAD~n</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # n 是包含空 commit 的範圍</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>在編輯器中：</p><ul><li><p>將空 commit 行改為 <code>drop</code></p></li><li><p>或直接刪除該行</p></li><li><p>方法 2: 使用 Reset (最新 commit)</p></li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> reset</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --hard</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> HEAD~1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>方法 3: 在 SourceTree 中處理</li></ul><ol><li><p><strong>Interactive Rebase</strong>:</p><ul><li>右鍵點擊空 commit 上方的 commit</li><li>選擇「Rebase children of [commit] interactively...」</li><li>將空 commit 設為「drop」或刪除該行</li></ul></li><li><p><strong>Reset</strong>:</p><ul><li>右鍵點擊空 commit 的上一個 commit</li><li>選擇「Reset current branch to this commit」</li><li>選擇「Hard」模式</li></ul></li></ol><h2 id="注意事項" tabindex="-1"><a class="header-anchor" href="#注意事項"><span>注意事項</span></a></h2><h3 id="重要警告" tabindex="-1"><a class="header-anchor" href="#重要警告"><span>重要警告</span></a></h3><ul><li><code>filter-branch</code> 會重寫歷史記錄</li><li>如果其他人已經基於該分支工作，需要協調處理</li><li>建議在操作前創建備份分支</li></ul><h3 id="最佳實踐" tabindex="-1"><a class="header-anchor" href="#最佳實踐"><span>最佳實踐</span></a></h3><ol><li><p><strong>操作前備份</strong>:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> checkout</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -b</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> backup-branch</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> checkout</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> original-branch</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>通知團隊成員</strong>:</p><ul><li>告知將要重寫歷史</li><li>確保沒有其他人正在該分支上工作</li></ul></li><li><p><strong>驗證結果</strong>:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> log</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --oneline</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> show</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --stat</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> HEAD~3</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 檢查幾個 commit</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h2 id="範例場景" tabindex="-1"><a class="header-anchor" href="#範例場景"><span>範例場景</span></a></h2><h3 id="場景-1-意外推送了機密檔案" tabindex="-1"><a class="header-anchor" href="#場景-1-意外推送了機密檔案"><span>場景 1: 意外推送了機密檔案</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 清理 config/secrets.yml</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> filter-branch</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --force</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --index-filter</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;git rm --cached --ignore-unmatch config/secrets.yml&#39;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> feature/user-auth</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 推送變更</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> push</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> origin</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> feature/user-auth</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --force</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 清理本地</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> for-each-ref</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --format=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;%(refname)&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> refs/original/</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">xargs</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> update-ref</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -d</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> gc</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --prune=now</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="場景-2-清理整個-logs-資料夾" tabindex="-1"><a class="header-anchor" href="#場景-2-清理整個-logs-資料夾"><span>場景 2: 清理整個 logs 資料夾</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 清理所有 log 檔案</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> filter-branch</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --force</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --index-filter</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;git rm -rf --cached --ignore-unmatch logs/&#39;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> main</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 處理可能出現的空 commit</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rebase</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> HEAD~10</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 檢查最近 10 個 commit</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="參考資料" tabindex="-1"><a class="header-anchor" href="#參考資料"><span>參考資料</span></a></h2><ul><li><a href="https://git-scm.com/docs/git-filter-branch" target="_blank" rel="noopener noreferrer">Git 官方文件 - git-filter-branch</a></li><li><a href="https://git-scm.com/book/zh-tw/v2/Git-%E5%B7%A5%E5%85%B7-%E9%87%8D%E5%AF%AB%E6%AD%B7%E5%8F%B2" target="_blank" rel="noopener noreferrer">Git 官方文件 - 重寫歷史</a></li></ul>`,57))])}const o=e(d,[["render",k]]),b=JSON.parse('{"path":"/posts/2025-07-29-git-filter-branch-guide/","title":"Git Filter Branch 清理指南","lang":"zh-TW","frontmatter":{"title":"Git Filter Branch 清理指南","description":"使用 git filter-branch 重寫 Git 歷史記錄，清理不該存在的檔案","date":"2025-08-09T00:00:00.000Z","category":"版本控制","tag":["git","GitHub","GitLab"],"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Git Filter Branch 清理指南\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2025-08-09T00:00:00.000Z\\",\\"dateModified\\":\\"2025-08-09T18:04:52.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Pamis Wang\\",\\"url\\":\\"https://pamis.dev\\",\\"email\\":\\"pamis.wang@gmail.com\\"}]}"],["meta",{"property":"og:url","content":"https://pamis.dev/posts/2025-07-29-git-filter-branch-guide/"}],["meta",{"property":"og:site_name","content":"Pamis Blog"}],["meta",{"property":"og:title","content":"Git Filter Branch 清理指南"}],["meta",{"property":"og:description","content":"使用 git filter-branch 重寫 Git 歷史記錄，清理不該存在的檔案"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-TW"}],["meta",{"property":"og:updated_time","content":"2025-08-09T18:04:52.000Z"}],["meta",{"property":"article:tag","content":"GitLab"}],["meta",{"property":"article:tag","content":"GitHub"}],["meta",{"property":"article:tag","content":"git"}],["meta",{"property":"article:published_time","content":"2025-08-09T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-08-09T18:04:52.000Z"}]]},"git":{"createdTime":1754749956000,"updatedTime":1754762692000,"contributors":[{"name":"Pamis Wang","username":"","email":"pamis.wang@gmail.com","commits":2},{"name":"Claude","username":"Claude","email":"noreply@anthropic.com","commits":2,"url":"https://github.com/Claude"}]},"readingTime":{"minutes":4.36,"words":1309},"filePathRelative":"posts/2025-07-29-git-filter-branch-guide/index.md","excerpt":"\\n<h2>前言</h2>\\n<p>在開發過程中難免會犯錯，像是不小心推送了機密檔案、大型檔案，或是一些不該存在於版本控制中的檔案。</p>\\n<p>如果專案還很新，可以砍掉 .git 目錄，但過去的提交紀錄也都會不見。</p>\\n<p>這時候就需要用到 <code>git filter-branch</code> 來重寫 Git 歷史記錄。</p>\\n"}');export{o as comp,b as data};
